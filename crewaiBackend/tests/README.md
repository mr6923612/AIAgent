# æµ‹è¯•æ–‡æ¡£

## æµ‹è¯•æ¦‚è¿°

æœ¬ç›®å½•åŒ…å«AI Agentç³»ç»Ÿçš„æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹ï¼Œç¡®ä¿ç³»ç»ŸåŠŸèƒ½çš„æ­£ç¡®æ€§å’Œç¨³å®šæ€§ã€‚

## æµ‹è¯•ç»“æ„

```
tests/
â”œâ”€â”€ README.md                    # æµ‹è¯•æ–‡æ¡£
â”œâ”€â”€ test_session_management.py   # ä¼šè¯ç®¡ç†æµ‹è¯•
â”œâ”€â”€ integration/                 # é›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ test_backend_api.py     # åç«¯APIæµ‹è¯•
â”‚   â””â”€â”€ ...
â””â”€â”€ unit/                       # å•å…ƒæµ‹è¯•
    â”œâ”€â”€ test_fuzzy_matching.py  # æ¨¡ç³ŠåŒ¹é…æµ‹è¯•
    â””â”€â”€ ...
```

## æµ‹è¯•å·¥å…·

### 1. æµ‹è¯•è¿è¡Œè„šæœ¬

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
python scripts/run_tests.py

# è¿è¡ŒæŒ‡å®šæµ‹è¯•
python scripts/run_tests.py --test test_session_management

# åªè¿è¡Œæ¸…ç†
python scripts/run_tests.py --cleanup-only

# è·³è¿‡æ¸…ç†
python scripts/run_tests.py --no-cleanup
```

### 2. ä¼šè¯æ¸…ç†å·¥å…·

```bash
# æ¸…ç†æ‰€æœ‰ä¼šè¯
python scripts/cleanup_sessions.py

# æ¸…ç†æ‰€æœ‰ä¼šè¯ï¼ˆåŒ…æ‹¬æ•°æ®åº“è¡¨ï¼‰
python scripts/cleanup_sessions.py --database

# è·³è¿‡RAGFlowæ¸…ç†
python scripts/cleanup_sessions.py --no-ragflow

# ç¡®è®¤æ¸…ç†ï¼ˆè·³è¿‡ç¡®è®¤æç¤ºï¼‰
python scripts/cleanup_sessions.py --confirm
```

### 3. æµ‹è¯•ä¼šè¯æ¸…ç†

```bash
# æ¸…ç†æµ‹è¯•ä¼šè¯
python scripts/test_cleanup.py --test-only

# æ¸…ç†æ‰€æœ‰ä¼šè¯
python scripts/test_cleanup.py --all
```

## æµ‹è¯•ç”¨ä¾‹è¯´æ˜

### ä¼šè¯ç®¡ç†æµ‹è¯• (test_session_management.py)

æµ‹è¯•ä¼šè¯çš„åˆ›å»ºã€è·å–ã€åˆ é™¤ã€æ¶ˆæ¯ç®¡ç†ç­‰åŠŸèƒ½ï¼š

- **test_create_session**: æµ‹è¯•æœ¬åœ°ä¼šè¯åˆ›å»º
- **test_create_session_via_api**: æµ‹è¯•APIä¼šè¯åˆ›å»º
- **test_get_session**: æµ‹è¯•ä¼šè¯è·å–
- **test_add_message**: æµ‹è¯•æ¶ˆæ¯æ·»åŠ 
- **test_delete_session**: æµ‹è¯•æœ¬åœ°ä¼šè¯åˆ é™¤
- **test_delete_session_via_api**: æµ‹è¯•APIä¼šè¯åˆ é™¤
- **test_ragflow_integration**: æµ‹è¯•RAGFlowé›†æˆ
- **test_multiple_sessions**: æµ‹è¯•å¤šä¼šè¯ç®¡ç†

### é›†æˆæµ‹è¯• (integration/)

æµ‹è¯•ç³»ç»Ÿå„ç»„ä»¶ä¹‹é—´çš„é›†æˆï¼š

- **test_backend_api.py**: æµ‹è¯•åç«¯APIæ¥å£
- å…¶ä»–é›†æˆæµ‹è¯•...

### å•å…ƒæµ‹è¯• (unit/)

æµ‹è¯•å•ä¸ªç»„ä»¶çš„åŠŸèƒ½ï¼š

- **test_fuzzy_matching.py**: æµ‹è¯•æ¨¡ç³ŠåŒ¹é…åŠŸèƒ½
- å…¶ä»–å•å…ƒæµ‹è¯•...

## æµ‹è¯•æœ€ä½³å®è·µ

### 1. æµ‹è¯•å‰å‡†å¤‡

```python
def setup(self):
    """æµ‹è¯•å‰å‡†å¤‡"""
    print("ğŸ”§ æµ‹è¯•å‰å‡†å¤‡...")
    # åˆå§‹åŒ–å¿…è¦çš„ç»„ä»¶
    # æ¸…ç†å¯èƒ½å­˜åœ¨çš„æµ‹è¯•æ•°æ®
```

### 2. æµ‹è¯•åæ¸…ç†

```python
def teardown(self):
    """æµ‹è¯•åæ¸…ç†"""
    print("ğŸ§¹ æµ‹è¯•åæ¸…ç†...")
    # æ¸…ç†æµ‹è¯•æ•°æ®
    # ç¡®ä¿ä¸å½±å“å…¶ä»–æµ‹è¯•
```

### 3. ä¼šè¯æ³¨å†Œ

```python
# åœ¨æµ‹è¯•ä¸­åˆ›å»ºä¼šè¯åï¼Œæ³¨å†Œåˆ°æ¸…ç†å™¨
register_test_session(session_id, ragflow_session_id)
```

### 4. å¼‚å¸¸å¤„ç†

```python
try:
    # æµ‹è¯•ä»£ç 
    assert condition, "é”™è¯¯ä¿¡æ¯"
    print("âœ… æµ‹è¯•é€šè¿‡")
except Exception as e:
    print(f"âŒ æµ‹è¯•å¤±è´¥: {e}")
    raise
```

## æµ‹è¯•æ•°æ®ç®¡ç†

### 1. æµ‹è¯•ä¼šè¯

- æ‰€æœ‰æµ‹è¯•åˆ›å»ºçš„ä¼šè¯éƒ½ä¼šè‡ªåŠ¨æ³¨å†Œåˆ°æ¸…ç†å™¨
- æµ‹è¯•å®Œæˆåè‡ªåŠ¨æ¸…ç†ï¼Œé¿å…æ•°æ®æ±¡æŸ“
- æ”¯æŒæ¸…ç†æœ¬åœ°ä¼šè¯å’ŒRAGFlowä¼šè¯

### 2. æµ‹è¯•ç”¨æˆ·

- ä½¿ç”¨ç‰¹å®šçš„æµ‹è¯•ç”¨æˆ·IDï¼ˆå¦‚ `test_user`, `test_api_user`ï¼‰
- é¿å…ä¸çœŸå®ç”¨æˆ·æ•°æ®å†²çª
- æµ‹è¯•å®Œæˆåæ¸…ç†ç›¸å…³æ•°æ®

### 3. æµ‹è¯•æ•°æ®éš”ç¦»

- æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹ç‹¬ç«‹è¿è¡Œ
- æµ‹è¯•é—´ä¸å…±äº«æ•°æ®
- ç¡®ä¿æµ‹è¯•çš„å¯é‡å¤æ€§

## è¿è¡Œæµ‹è¯•

### 1. æœ¬åœ°å¼€å‘

```bash
# è¿›å…¥åç«¯ç›®å½•
cd crewaiBackend

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
python scripts/run_tests.py

# è¿è¡Œç‰¹å®šæµ‹è¯•
python tests/test_session_management.py --test create
```

### 2. CI/CD

```bash
# åœ¨CIç¯å¢ƒä¸­è¿è¡Œæµ‹è¯•
python scripts/run_tests.py --no-cleanup
```

### 3. è°ƒè¯•æµ‹è¯•

```bash
# è¿è¡Œå•ä¸ªæµ‹è¯•å¹¶æŸ¥çœ‹è¯¦ç»†è¾“å‡º
python tests/test_session_management.py --test ragflow -v
```

## æµ‹è¯•æŠ¥å‘Š

æµ‹è¯•è¿è¡Œåä¼šç”Ÿæˆè¯¦ç»†çš„æŠ¥å‘Šï¼š

- âœ… é€šè¿‡çš„æµ‹è¯•æ•°é‡
- âŒ å¤±è´¥çš„æµ‹è¯•æ•°é‡
- ğŸ“Š æµ‹è¯•ç»Ÿè®¡ä¿¡æ¯
- â° æµ‹è¯•æ—¶é—´ä¿¡æ¯
- ğŸ§¹ æ¸…ç†çŠ¶æ€

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æµ‹è¯•å¤±è´¥**ï¼š
   - æ£€æŸ¥æœåŠ¡æ˜¯å¦è¿è¡Œ
   - éªŒè¯é…ç½®æ˜¯å¦æ­£ç¡®
   - æŸ¥çœ‹é”™è¯¯æ—¥å¿—

2. **æ¸…ç†å¤±è´¥**ï¼š
   - æ£€æŸ¥æ•°æ®åº“è¿æ¥
   - éªŒè¯RAGFlowæœåŠ¡çŠ¶æ€
   - æ‰‹åŠ¨è¿è¡Œæ¸…ç†å·¥å…·

3. **ä¼šè¯æ®‹ç•™**ï¼š
   - è¿è¡Œ `python scripts/cleanup_sessions.py`
   - æ£€æŸ¥æ•°æ®åº“è¡¨
   - éªŒè¯RAGFlowä¼šè¯çŠ¶æ€

## è´¡çŒ®æŒ‡å—

### æ·»åŠ æ–°æµ‹è¯•

1. åœ¨ç›¸åº”ç›®å½•åˆ›å»ºæµ‹è¯•æ–‡ä»¶
2. ç»§æ‰¿æµ‹è¯•åŸºç±»æˆ–ä½¿ç”¨æµ‹è¯•å·¥å…·
3. ç¡®ä¿æµ‹è¯•åæ¸…ç†
4. æ›´æ–°æ–‡æ¡£

### ä¿®æ”¹ç°æœ‰æµ‹è¯•

1. ç¡®ä¿å‘åå…¼å®¹
2. æ›´æ–°ç›¸å…³æ–‡æ¡£
3. éªŒè¯æµ‹è¯•é€šè¿‡
4. æäº¤ä»£ç 

## è”ç³»æ–¹å¼

å¦‚æœ‰æµ‹è¯•ç›¸å…³é—®é¢˜ï¼Œè¯·ï¼š

1. æŸ¥çœ‹æœ¬æ–‡æ¡£
2. æ£€æŸ¥æµ‹è¯•æ—¥å¿—
3. æäº¤Issue
4. è”ç³»å¼€å‘å›¢é˜Ÿ
